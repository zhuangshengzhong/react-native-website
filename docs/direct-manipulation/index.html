<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>直接操作 · React Native 中文网</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="##### 本文档贡献者：[sunnylqm](https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users)(99.51%), [306703082](https://github.com/search?q=306703082%40qq.com+in%3Aemail&amp;type=Users)(0.49%)"/><meta name="docsearch:version" content="0.61"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="直接操作 · React Native 中文网"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reactnativecn.github.io/react-native-website/"/><meta property="og:description" content="##### 本文档贡献者：[sunnylqm](https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users)(99.51%), [306703082](https://github.com/search?q=306703082%40qq.com+in%3Aemail&amp;type=Users)(0.49%)"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/react-native-website/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-dark.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-63485149-4', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/focus-visible@5.0.2/dist/focus-visible.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@production/cnwebsite/static/js/codeblocks.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@production/cnwebsite/static/js/tabs.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@production/cnwebsite/static/js/doccode.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="https://cdn.jsdelivr.net/gh/facebook/docusaurus@1.14.4/packages/docusaurus-1.x/lib/static/js/scrollSpy.js"></script><link rel="stylesheet" href="/react-native-website/css/main.css"/><script src="https://cdn.jsdelivr.net/gh/facebook/docusaurus@1.14.4/packages/docusaurus-1.x/lib/static/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/react-native-website/"><img class="logo" src="/react-native-website/img/header_logo.svg" alt="React Native 中文网"/><h2 class="headerTitleWithLogo">React Native 中文网</h2></a><a href="/react-native-website/versions"><h3>0.61</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/react-native-website/docs/getting-started" target="_self">文档</a></li><li class=""><a href="/react-native-website/docs/activityindicator" target="_self">API</a></li><li class=""><a href="//github.com/reactnativecn/react-native-website/issues" target="_blank">讨论</a></li><li class=""><a href="//update.reactnative.cn" target="_blank">热更新</a></li><li class=""><a href="/react-native-website/about" target="_self">关于</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/facebook/react-native" target="_self">GitHub</a></li><li class=""><a href="//zh-hans.reactjs.org/" target="_blank">React</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>进阶指南</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">入门基础<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-website/docs/getting-started">搭建开发环境</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/intro-react-native-components">核心组件与原生组件</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/intro-react">React基础</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/tutorial">示例教程：Hello World</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/props">Props（属性）</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/state">State（状态）</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/handling-text-input">处理文本输入</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/handling-touches">处理触摸事件</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/using-a-scrollview">使用滚动视图</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/using-a-listview">使用长列表</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/network">网络</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/sample-application-movies">示例教程：电影列表</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/more-resources">其他参考资源</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">设计<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-website/docs/style">样式</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/height-and-width">高度与宽度</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/flexbox">使用Flexbox布局</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">进阶指南<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-website/docs/components-and-apis">组件和API</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/fast-refresh">快速自动刷新 Fast Refresh</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/platform-specific-code">特定平台代码</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/navigation">使用导航器跳转页面</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/images">图片</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/animations">动画</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/accessibility">无障碍功能</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/improvingux">改进用户体验</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/optimizing-flatlist-configuration">列表配置优化</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/timers">定时器</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/debugging">调试</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/performance">性能</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/gesture-responder-system">手势响应系统</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/javascript-environment">JavaScript环境</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/typescript">使用TypeScript</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/react-native-website/docs/direct-manipulation">直接操作</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/colors">颜色</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/integration-with-existing-apps">集成到现有原生应用</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/building-for-apple-tv">为电视和机顶盒制作应用</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/running-on-device">在设备上运行</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/upgrading">更新</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/native-modules-setup">原生模块配置</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/out-of-tree-platforms">多平台支持</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/building-from-source">从源代码编译React Native</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/publishing-forks">发布自己定制的ReactNative包</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/testing">Testing your Changes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">使用指南(iOS)<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-website/docs/native-modules-ios">原生模块</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/native-components-ios">原生UI组件</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/linking-libraries-ios">链接原生库</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/running-on-simulator-ios">在iOS模拟器上运行</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/communication-ios">和原生端通信</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/app-extensions">iOS应用扩展</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">使用指南(Android)<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/react-native-website/docs/native-modules-android">原生模块</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/native-components-android">原生UI组件</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/headless-js-android">Headless JS（后台任务）</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/signed-apk-android">打包APK</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/removing-default-permissions">移除不需要的权限</a></li><li class="navListItem"><a class="navItem" href="/react-native-website/docs/hermes">Using Hermes</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="//github.com/reactnativecn/react-native-website/blob/production/cndocs/direct-manipulation.md" target="_blank" rel="noreferrer noopener">帮助改进此文档</a><h1 id="__docusaurus" class="postHeaderTitle">直接操作</h1></header><article><div><span><h5><a class="anchor" aria-hidden="true" id="本文档贡献者：sunnylqmhttpsgithubcomsearchqsunnylqm40qqcomin3aemailtypeusers9951-306703082httpsgithubcomsearchq30670308240qqcomin3aemailtypeusers049"></a><a href="#本文档贡献者：sunnylqmhttpsgithubcomsearchqsunnylqm40qqcomin3aemailtypeusers9951-306703082httpsgithubcomsearchq30670308240qqcomin3aemailtypeusers049" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>本文档贡献者：<a href="https://github.com/search?q=sunnylqm%40qq.com+in%3Aemail&amp;type=Users">sunnylqm</a>(99.51%), <a href="https://github.com/search?q=306703082%40qq.com+in%3Aemail&amp;type=Users">306703082</a>(0.49%)</h5>
<p>有时候我们需要直接改动组件并触发局部的刷新，但不使用 state 或是 props。譬如在浏览器中使用 React 库，有时候会需要直接修改一个 DOM 节点，而在手机 App 中操作 View 时也会碰到同样的情况。在 React Native 中，<code>setNativeProps</code>就是等价于直接操作 DOM 节点的方法。</p>
<blockquote>
<p>什么时候使用 setNativeProps 呢？在（不得不）频繁刷新而又遇到了性能瓶颈的时候。</p>
<p>直接操作组件并不是应该经常使用的工具。一般来说只是用来创建连续的动画，同时避免渲染组件结构和同步太多视图变化所带来的大量开销。<code>setNativeProps</code>是一个“简单粗暴”的方法，它直接在底层（DOM、UIView 等）而不是 React 组件中记录 state，这样会使代码逻辑难以理清。所以在使用这个方法之前，请尽量先尝试用<code>setState</code>和<a href="http://facebook.github.io/react/docs/advanced-performance.html#shouldcomponentupdate-in-action">shouldComponentUpdate</a>方法来解决问题。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="setnativeprops-与-touchableopacity"></a><a href="#setnativeprops-与-touchableopacity" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>setNativeProps 与 TouchableOpacity</h2>
<p><a href="https://github.com/facebook/react-native/blob/master/Libraries/Components/Touchable/TouchableOpacity.js">TouchableOpacity</a>这个组件就在内部使用了<code>setNativeProps</code>方法来更新其子组件的透明度：</p>
<pre><code class="hljs css language-jsx">setOpacityTo(value) {
  <span class="hljs-comment">// Redacted: animation related code</span>
  <span class="hljs-keyword">this</span>.refs[CHILD_REF].setNativeProps({
    <span class="hljs-attr">opacity</span>: value
  });
},
</code></pre>
<p>由此我们可以写出下面这样的代码：子组件可以响应点击事件，更改自己的透明度。而子组件自身并不需要处理这件事情，也不需要在实现中做任何修改。</p>
<pre><code class="hljs css language-jsx">&lt;TouchableOpacity onPress={this._handlePress}&gt;
  &lt;View style={styles.button}&gt;
    &lt;Text&gt;Press me!&lt;/Text&gt;
  &lt;/View&gt;
&lt;/TouchableOpacity&gt;
</code></pre>
<p>如果不使用<code>setNativeProps</code>来实现这一需求，那么一种可能的办法是把透明值保存到 state 中，然后在<code>onPress</code>事件触发时更新这个值：</p>
<pre><code class="hljs css language-jsx"><span class="hljs-keyword">constructor</span>(props) {
  <span class="hljs-keyword">super</span>(props);
  <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">myButtonOpacity</span>: <span class="hljs-number">1</span>, };
}

render() {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TouchableOpacity</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> this.setState({myButtonOpacity: 0.5})}
                      onPressOut={() =&gt; this.setState({myButtonOpacity: 1})}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{[styles.button,</span> {<span class="hljs-attr">opacity:</span> <span class="hljs-attr">this.state.myButtonOpacity</span>}]}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Press me!<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">TouchableOpacity</span>&gt;</span></span>
  )
}
</code></pre>
<p>比起之前的例子，这一做法会消耗大量的计算 —— 每一次透明值变更的时候 React 都要重新渲染组件结构，即便视图的其他属性和子组件并没有变化。一般来说这一开销也不足为虑，但当执行连续的动画以及响应用户手势的时候，只有正确地优化组件才能提高动画的流畅度。</p>
<p>如果你看过<a href="https://github.com/facebook/react-native/blob/master/Libraries/Renderer/oss/ReactNativeRenderer-prod.js">NativeMethodsMixin</a>中的<code>setNativeProps</code>方法的实现，你就会发现它实际是对<code>RCTUIManager.updateView</code>的封装 —— 而这正是重渲染所触发的函数调用，具体可以参看<a href="https://github.com/facebook/react/blob/master/src/renderers/native/ReactNativeBaseComponent.js">ReactNativeBaseComponent.js 中的 receiveComponent</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="复合组件与-setnativeprops"></a><a href="#复合组件与-setnativeprops" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复合组件与 setNativeProps</h2>
<p>复合组件并不是单纯的由一个原生视图构成，所以你不能对其直接使用<code>setNativeProps</code>。比如下面这个例子：</p>
<pre><code class="hljs css language-SnackPlayer name=setNativeProps%20with%20Composite%20Components"><span class="hljs-keyword">import</span> <span class="hljs-type">React</span> from <span class="hljs-symbol">'reac</span>t';
<span class="hljs-keyword">import</span> { <span class="hljs-type">Text</span>, <span class="hljs-type">TouchableOpacity</span>, <span class="hljs-type">View</span> } from <span class="hljs-symbol">'react</span>-native';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  render() {
    <span class="hljs-keyword">return</span> (
      &lt;<span class="hljs-type">View</span>&gt;
        &lt;<span class="hljs-type">Text</span>&gt;{<span class="hljs-keyword">this</span>.props.label}&lt;/<span class="hljs-type">Text</span>&gt;
      &lt;/<span class="hljs-type">View</span>&gt;
    )
  }
}

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  render() {
    <span class="hljs-keyword">return</span> (
      &lt;<span class="hljs-type">TouchableOpacity</span>&gt;
        &lt;<span class="hljs-type">MyButton</span> label=<span class="hljs-string">"Press me!"</span> /&gt;
      &lt;/<span class="hljs-type">TouchableOpacity</span>&gt;
    )
  }
}
</code></pre>
<p>跑这个例子会马上看到一行报错： <code>Touchable child must either be native or forward setNativeProps to a native component</code>。这是因为<code>MyButton</code>并非直接由原生视图构成，而我们只能给原生视图设置透明值。你可以尝试这样去理解：如果你通过<code>React.createClass</code>方法自定义了一个组件，直接给它设置样式 prop 是不会生效的，你得把样式 props 层层向下传递给子组件，直到子组件是一个能够直接定义样式的原生组件。同理，我们也需要把<code>setNativeProps</code>传递给由原生组件封装的子组件。</p>
<h4><a class="anchor" aria-hidden="true" id="将-setnativeprops-传递给子组件"></a><a href="#将-setnativeprops-传递给子组件" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>将 setNativeProps 传递给子组件</h4>
<p>具体要做的就是在我们的自定义组件中再封装一个<code>setNativeProps</code>方法，其内容为对合适的子组件调用真正的<code>setNativeProps</code>方法，并传递要设置的参数。</p>
<pre><code class="hljs css language-SnackPlayer name=Forwarding%20setNativeProps"><span class="hljs-keyword">import</span> <span class="hljs-type">React</span> from <span class="hljs-symbol">'reac</span>t';
<span class="hljs-keyword">import</span> { <span class="hljs-type">Text</span>, <span class="hljs-type">TouchableOpacity</span>, <span class="hljs-type">View</span> } from <span class="hljs-symbol">'react</span>-native';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  setNativeProps = (nativeProps) =&gt; {
    <span class="hljs-keyword">this</span>._root.setNativeProps(nativeProps);
  }

  render() {
    <span class="hljs-keyword">return</span> (
      &lt;<span class="hljs-type">View</span> ref={component =&gt; <span class="hljs-keyword">this</span>._root = component} {...<span class="hljs-keyword">this</span>.props}&gt;
        &lt;<span class="hljs-type">Text</span>&gt;{<span class="hljs-keyword">this</span>.props.label}&lt;/<span class="hljs-type">Text</span>&gt;
      &lt;/<span class="hljs-type">View</span>&gt;
    )
  }
}

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  render() {
    <span class="hljs-keyword">return</span> (
      &lt;<span class="hljs-type">TouchableOpacity</span>&gt;
        &lt;<span class="hljs-type">MyButton</span> label=<span class="hljs-string">"Press me!"</span> /&gt;
      &lt;/<span class="hljs-type">TouchableOpacity</span>&gt;
    )
  }
}
</code></pre>
<p>现在你可以用<code>MyButton</code>来代替<code>TouchableOpacity</code>了！有一点需要特别说明：这里我们使用了<a href="https://doc.react-china.org/docs/refs-and-the-dom.html">ref 回调</a>语法，而不是传统的字符串型 ref 引用。</p>
<p>你可能还会注意到我们在向下传递 props 时使用了<code>{...this.props}</code>语法（这一用法的说明请参考<a href="http://es6.ruanyifeng.com/#docs/object">对象的扩展运算符</a>）。这是因为<code>TouchableOpacity</code>本身其实也是个复合组件， 它除了要求在子组件上执行<code>setNativeProps</code> 以外，还要求子组件对触摸事件进行处理。因此，它会传递多个 props，其中包含了<a href="view.html#onmoveshouldsetresponder">onmoveshouldsetresponder</a> 函数，这个函数需要回调给<code>TouchableOpacity</code>组件，以完成触摸事件的处理。与之相对的是<code>TouchableHighlight</code>组件，它本身是由原生视图构成，因而只需要我们实现<code>setNativeProps</code>。</p>
<h2><a class="anchor" aria-hidden="true" id="setnativeprops-to-clear-textinput-value"></a><a href="#setnativeprops-to-clear-textinput-value" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>setNativeProps to clear TextInput value</h2>
<p>Another very common use case of <code>setNativeProps</code> is to clear the value of a TextInput. The <code>controlled</code> prop of TextInput can sometimes drop characters when the <code>bufferDelay</code> is low and the user types very quickly. Some developers prefer to skip this prop entirely and instead use <code>setNativeProps</code> to directly manipulate the TextInput value when necessary. For example, the following code demonstrates clearing the input when you tap a button:</p>
<pre><code class="hljs css language-SnackPlayer name=Clear%20text"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { TextInput, Text, TouchableOpacity, View } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  clearText = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">this</span>._textInput.setNativeProps({<span class="hljs-attr">text</span>: <span class="hljs-string">''</span>});
  }

  render() {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{flex:</span> <span class="hljs-attr">1</span>, <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>'}}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{component</span> =&gt;</span> this._textInput = component}
          style={{height: 50, width: 200, marginHorizontal: 20, borderWidth: 1, borderColor: '#ccc'}}
        /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">TouchableOpacity</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">{this.clearText}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Clear text<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">TouchableOpacity</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
    );
  }
}
</code></pre>
<h1><a class="anchor" aria-hidden="true" id="避免和-render-方法的冲突"></a><a href="#避免和-render-方法的冲突" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>避免和 render 方法的冲突</h1>
<p>如果要更新一个由 render 方法来维护的属性，则可能会碰到一些出人意料的 bug。因为每一次组件重新渲染都可能引起属性变化，这样一来，之前通过<code>setNativeProps</code>所设定的值就被完全忽略和覆盖掉了。</p>
<h2><a class="anchor" aria-hidden="true" id="setnativeprops-与-shouldcomponentupdate"></a><a href="#setnativeprops-与-shouldcomponentupdate" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>setNativeProps 与 shouldComponentUpdate</h2>
<p>通过<a href="https://facebook.github.io/react/docs/advanced-performance.html#avoiding-reconciling-the-dom">巧妙运用<code>shouldComponentUpdate</code>方法</a>，可以避免重新渲染那些实际没有变化的子组件所带来的额外开销，此时使用<code>setState</code>的性能已经可以与<code>setNativeProps</code>相媲美了。</p>
<h2><a class="anchor" aria-hidden="true" id="other-native-methods"></a><a href="#other-native-methods" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other native methods</h2>
<p>The methods described here are available on most of the default components provided by React Native. Note, however, that they are <em>not</em> available on composite components that aren't directly backed by a native view. This will generally include most components that you define in your own app.</p>
<h3><a class="anchor" aria-hidden="true" id="measurecallback"></a><a href="#measurecallback" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>measure(callback)</h3>
<p>Determines the location on screen, width, and height of the given view and returns the values via an async callback. If successful, the callback will be called with the following arguments:</p>
<ul>
<li>x</li>
<li>y</li>
<li>width</li>
<li>height</li>
<li>pageX</li>
<li>pageY</li>
</ul>
<p>Note that these measurements are not available until after the rendering has been completed in native. If you need the measurements as soon as possible, consider using the <a href="/react-native-website/docs/view#onlayout"><code>onLayout</code> prop</a> instead.</p>
<h3><a class="anchor" aria-hidden="true" id="measureinwindowcallback"></a><a href="#measureinwindowcallback" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>measureInWindow(callback)</h3>
<p>Determines the location of the given view in the window and returns the values via an async callback. If the React root view is embedded in another native view, this will give you the absolute coordinates. If successful, the callback will be called with the following arguments:</p>
<ul>
<li>x</li>
<li>y</li>
<li>width</li>
<li>height</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="measurelayoutrelativetonativenode-onsuccess-onfail"></a><a href="#measurelayoutrelativetonativenode-onsuccess-onfail" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>measureLayout(relativeToNativeNode, onSuccess, onFail)</h3>
<p>Like <code>measure()</code>, but measures the view relative an ancestor, specified as <code>relativeToNativeNode</code>. This means that the returned x, y are relative to the origin x, y of the ancestor view.</p>
<p>As always, to obtain a native node handle for a component, you can use <code>findNodeHandle(component)</code>.</p>
<pre><code class="hljs css language-jsx"><span class="hljs-keyword">import</span> {findNodeHandle} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="focus"></a><a href="#focus" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>focus()</h3>
<p>Requests focus for the given input or view. The exact behavior triggered will depend on the platform and type of view.</p>
<h3><a class="anchor" aria-hidden="true" id="blur"></a><a href="#blur" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>blur()</h3>
<p>Removes focus from an input or view. This is the opposite of <code>focus()</code>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/react-native-website/docs/typescript"><span class="arrow-prev">← </span><span class="function-name-prevnext">使用TypeScript</span></a><a class="docs-next button" href="/react-native-website/docs/colors"><span>颜色</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#setnativeprops-与-touchableopacity">setNativeProps 与 TouchableOpacity</a></li><li><a href="#复合组件与-setnativeprops">复合组件与 setNativeProps</a></li><li><a href="#setnativeprops-to-clear-textinput-value">setNativeProps to clear TextInput value</a></li><li><a href="#setnativeprops-与-shouldcomponentupdate">setNativeProps 与 shouldComponentUpdate</a></li><li><a href="#other-native-methods">Other native methods</a><ul class="toc-headings"><li><a href="#measurecallback">measure(callback)</a></li><li><a href="#measureinwindowcallback">measureInWindow(callback)</a></li><li><a href="#measurelayoutrelativetonativenode-onsuccess-onfail">measureLayout(relativeToNativeNode, onSuccess, onFail)</a></li><li><a href="#focus">focus()</a></li><li><a href="#blur">blur()</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright"><p style="color:inherit">React Native中文网 © 2020 杭州欧石南网络科技有限公司</p><p style="color:inherit"><a href="http://beian.miit.gov.cn/">浙ICP备15023664号-3</a><img src="https://img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png" alt="浙公网安备 33010602005511号"/><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602005511">浙公网安备 33010602005511号</a></p></section><script>
        (function(){
          var c = document.createElement("div");
          c.setAttribute("id", "lv-container");
          c.setAttribute("data-id", "city");
          c.setAttribute("data-uid", "MTAyMC8zODM4NS8xNDkxMw==");
          var container = document.querySelector(".mainContainer")
          container && container.appendChild(c);
        })()
        </script><script src="https://cdn-city.livere.com/js/embed.dist.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '7ab53ed26928639bae06ef0f6165f68b',
                indexName: 'reactnative_cn',
                inputSelector: '#search_input_react',
                algoliaOptions: {"hitsPerPage":5}
              });
            </script></body></html>