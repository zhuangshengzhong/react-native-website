<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>ListView.DataSource · React Native 中文网</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="`ListViewDataSource`为`ListView`组件提供高性能的数据处理和访问。我们需要调用方法从原始输入数据中抽取数据来创建`ListViewDataSource`对象，并用其进行数据变更的比较。原始输入数据可以是简单的字符串数组，也可以是复杂嵌套的对象——分不同区(section)各自包含若干行(row)数据。"/><meta name="docsearch:version" content="0.62"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="ListView.DataSource · React Native 中文网"/><meta property="og:type" content="website"/><meta property="og:url" content="undefined/"/><meta property="og:description" content="`ListViewDataSource`为`ListView`组件提供高性能的数据处理和访问。我们需要调用方法从原始输入数据中抽取数据来创建`ListViewDataSource`对象，并用其进行数据变更的比较。原始输入数据可以是简单的字符串数组，也可以是复杂嵌套的对象——分不同区(section)各自包含若干行(row)数据。"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-dark.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-63485149-4', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/focus-visible@5.0.2/dist/focus-visible.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/js/codeblocks.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/js/tabs.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/js/doccode0325.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/js/snack.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/js/scrollSpy.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/css/main.css"/><script src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="https://cdn.jsdelivr.net/gh/reactnativecn/react-native-website@gh-pages/img/header_logo.svg" alt="React Native 中文网"/><h2 class="headerTitleWithLogo">React Native 中文网</h2></a><a href="/versions"><h3>0.62</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/getting-started" target="_self">文档</a></li><li class=""><a href="/docs/activityindicator" target="_self">API</a></li><li class=""><a href="//github.com/reactnativecn/react-native-website/issues" target="_blank">讨论</a></li><li class=""><a href="//update.react-native.cn" target="_blank">热更新</a></li><li class=""><a href="/about" target="_self">关于</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/facebook/react-native" target="_self">GitHub</a></li><li class=""><a href="//zh-hans.reactjs.org/" target="_blank">React</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="//github.com/reactnativecn/react-native-website/blob/production/cndocs/listviewdatasource.md" target="_blank" rel="noreferrer noopener">帮助改进此文档</a><h1 id="__docusaurus" class="postHeaderTitle">ListView.DataSource</h1></header><article><div><span><p><code>ListViewDataSource</code>为<code>ListView</code>组件提供高性能的数据处理和访问。我们需要调用方法从原始输入数据中抽取数据来创建<code>ListViewDataSource</code>对象，并用其进行数据变更的比较。原始输入数据可以是简单的字符串数组，也可以是复杂嵌套的对象——分不同区(section)各自包含若干行(row)数据。</p>
<p>要更新datasource中的数据，请（每次都重新）调用<code>cloneWithRows</code>方法（如果用到了section，则对应<code>cloneWithRowsAndSections</code>方法）。数据源中的数据本身是不可修改的，所以请勿直接尝试修改。clone方法会自动提取新数据并进行逐行对比（使用rowHasChanged方法中的策略），这样ListView就知道哪些行需要重新渲染了。</p>
<p>在下面这个例子中，一个组件在分块接受数据，这些数据由<code>_onDataArrived</code>方法处理——将新数据拼接（concat）到旧数据尾部，同时使用clone方法更新DataSource。我们使用concat方法来修改<code>this._data</code>以创建新数组，注意不能使用push方法拼接数组。实现<code>_rowHasChanged</code>方法需要透彻了解行数据的结构，以便提供高效的比对策略。</p>
<pre><code class="hljs css language-jsx"><span class="hljs-keyword">constructor</span>(props) {
  <span class="hljs-keyword">super</span>(props);
  <span class="hljs-keyword">var</span> ds = <span class="hljs-keyword">new</span> ListView.DataSource({<span class="hljs-attr">rowHasChanged</span>: <span class="hljs-function">(<span class="hljs-params">r1, r2</span>) =&gt;</span> r1 !== r2});
  <span class="hljs-keyword">this</span>.state = {
    ds,
  };
  <span class="hljs-keyword">this</span>._data = []; 
}

_onDataArrived = <span class="hljs-function">(<span class="hljs-params">newData</span>) =&gt;</span> {
  <span class="hljs-keyword">this</span>._data = <span class="hljs-keyword">this</span>._data.concat(newData);
  <span class="hljs-keyword">this</span>.setState({
    <span class="hljs-attr">ds</span>: <span class="hljs-keyword">this</span>.state.ds.cloneWithRows(<span class="hljs-keyword">this</span>._data)
  });
};
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="方法"></a><a href="#方法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法</h3>
<div class="props">
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="constructor"></a>constructor<span class="propType">(params)</span>
        <a class="hash-link" href="#constructor">#</a></h4>
        <div><p>你可以在构造函数中针对section标题和行数据提供自定义的提取方法和<code>hasChanged</code>比对方法。如果不提供，则会使用默认的<code>defaultGetRowData</code>和<code>defaultGetSectionHeaderData</code>方法来提取行数据和section标题。</p>
            <p>默认的提取函数可以处理下列形式的数据:</p>
            <p><code>{ sectionID_1: { rowID_1: rowData1, ... }, ... }</code></p>
            <p>或者：</p>
            <p><code>{ sectionID_1: [ rowData1, rowData2, ... ], ... }</code></p>
            <p>或者：</p>
            <p><code>[ [ rowData1, rowData2, ... ], ... ]</code></p>
            <p>构造函数可以接受下列四种参数（都是可选）：</p>
            <ul>
                <li>getRowData(dataBlob, sectionID, rowID);</li>
                <li>getSectionHeaderData(dataBlob, sectionID);</li>
                <li>rowHasChanged(prevRowData, nextRowData);</li>
                <li>sectionHeaderHasChanged(prevSectionData, nextSectionData);</li>
            </ul>
        </div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="clonewithrows"></a>cloneWithRows<span
            class="propType">(dataBlob, rowIdentities)</span> <a class="hash-link"
                                                                 href="#clonewithrows">#</a>
    </h4>
        <div><p>根据指定的<code>dataBlob</code>和
            <code>rowIdentities</code>为<code>ListViewDataSource</code>复制填充数据。<code>dataBlob</code>即原始数据。需要在初始化时定义抽取函数（否则使用默认的抽取函数）。</p>
            <p><code>rowIdentities</code>是一个二维数组，包含了行数据对应的id标识符，例如[['a1', 'a2'], ['b1', 'b2', 'b3'], ...]。如果没有指定此数组，则默认取行数据的key。</p>
            <p>注：此方法<strong>实际并没有</strong>复制数据。它只是重新创建一个datasource，然后将你指定的dataBlob传递给构造函数中指定的提取函数，因而会抛弃先前的数据。如果你希望保留先前的数据，则必须先自行进行新老数据的合并处理，然后再将合并后的结果作为<code>dataBlob</code>传递给此方法调用。</p></div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="clonewithrowsandsections"></a>cloneWithRowsAndSections<span
            class="propType">(dataBlob, sectionIdentities, rowIdentities)</span> <a class="hash-link"
                                                                                    href="#clonewithrowsandsections">#</a>
    </h4>
        <div><p>此方法作用基本等同<code>cloneWithRows</code>，区别在于可以额外指定<code>sectionIdentities</code> 。如果你不需要section，则直接使用<code>cloneWithRows</code>即可。</p>
            <p><code>sectionIdentities</code>同理是包含了section标识符的数组。例如['s1', 's2', ...]。如果没有指定此数组，则默认取section的key。</p>
            <p>注：此方法会返回新的对象！</p></div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="getrowcount"></a>getRowCount<span class="propType">()</span>
        <a class="hash-link" href="#getrowcount">#</a></h4></div>
    <div class="prop"><h4 class="propTitle"><a class="anchor"
                                               name="getrowandsectioncount"></a>getRowAndSectionCount<span
            class="propType">()</span> <a class="hash-link"
                                          href="#getrowandsectioncount">#</a></h4></div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="rowshouldupdate"></a>rowShouldUpdate<span
            class="propType">(sectionIndex, rowIndex)</span> <a class="hash-link"
                                                                href="#rowshouldupdate">#</a>
    </h4>
        <div><p>返回值表明某行数据是否已变更，需要重新渲染。</p></div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="getrowdata"></a>getRowData<span class="propType">(sectionIndex, rowIndex)</span>
        <a class="hash-link" href="#getrowdata">#</a></h4>
        <div><p>返回渲染行所需的数据（指定如何从原始dataBlob中提取数据）。</p></div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="getrowidforflatindex"></a>getRowIDForFlatIndex<span
            class="propType">(index)</span> <a class="hash-link"
                                               href="#getrowidforflatindex">#</a></h4>
        <div><p>给定索引值，求其对应rowID。如果查找不到则返回null。</p></div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="getsectionidforflatindex"></a>getSectionIDForFlatIndex<span
            class="propType">(index)</span> <a class="hash-link"
                                               href="#getsectionidforflatindex">#</a></h4>
        <div><p>给定索引值，求其对应sectionID。如果查找不到则返回null。</div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="getsectionlengths"></a>getSectionLengths<span
            class="propType">()</span> <a class="hash-link" href="#getsectionlengths">#</a>
    </h4>
        <div><p>返回一个数组，包含每个section的行数量。</p></div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="sectionheadershouldupdate"></a>sectionHeaderShouldUpdate<span
            class="propType">(sectionIndex)</span> <a class="hash-link"
                                                      href="#sectionheadershouldupdate">#</a>
    </h4>
        <div><p>返回值用于说明section标题是否需要重新渲染。</p></div>
    </div>
    <div class="prop"><h4 class="propTitle"><a class="anchor" name="getsectionheaderdata"></a>getSectionHeaderData<span
            class="propType">(sectionIndex)</span> <a class="hash-link"
                                                      href="#getsectionheaderdata">#</a>
    </h4>
        <div><p>获取section标题数据。</p></div>
    </div>
</div>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="copyright"><p style="color:inherit">React Native中文网 © 2020 武汉青罗网络科技有限公司</p><p style="color:inherit"><a href="http://beian.miit.gov.cn/">鄂ICP备20002031号</a><img src="https://img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png" alt="鄂公网安备 42011202001821号"/><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42011202001821">鄂公网安备 42011202001821号</a></p></section><script>
        (function(){
          var c = document.createElement("div");
          c.setAttribute("id", "lv-container");
          c.setAttribute("data-id", "city");
          c.setAttribute("data-uid", "MTAyMC8zODM4NS8xNDkxMw==");
          var container = document.querySelector(".mainContainer")
          container && container.appendChild(c);
        })()
        </script><script src="https://cdn-city.livere.com/js/embed.dist.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '7ab53ed26928639bae06ef0f6165f68b',
                indexName: 'reactnative_cn',
                inputSelector: '#search_input_react',
                algoliaOptions: {"hitsPerPage":5}
              });
            </script></body></html>